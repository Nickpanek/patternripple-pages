<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seamless Pattern Checker - PatternRipple</title>
  <meta name="description" content="Free tool to preview any image as a seamless tile. Upload an image and see a 4x4 repeat with optional gaps to inspect seams." />
  <style>
    :root { --bg: #0b0b0c; --panel: #151518; --text: #eaeaf0; --muted: #9aa0a6; --border: #232327; --accent: #7ee787; }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    a { color: #9ecbff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    header { padding: 16px; border-bottom: 1px solid var(--border); display: flex; gap: 12px; align-items: center; justify-content: space-between; background: rgba(21,21,24,0.8); position: sticky; top: 0; z-index: 10; backdrop-filter: blur(6px); }
    header .left { display: flex; align-items: center; gap: 12px; }
    header .brand { font-weight: 700; letter-spacing: 0.2px; }
    header .pill { padding: 4px 10px; border: 1px solid var(--border); border-radius: 999px; background: #111114; color: var(--muted); font-size: 12px; }
    main { display: grid; grid-template-columns: 340px 1fr; gap: 16px; padding: 16px; height: calc(100% - 65px); }
    @media (max-width: 980px) { main { grid-template-columns: 1fr; height: auto; } }
    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 14px; padding: 16px; }
    .panel h2 { margin: 0 0 12px; font-size: 16px; }
    .row { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 10px; margin-bottom: 10px; }
    .row label { font-size: 13px; color: var(--muted); }
    .controls .row input[type="number"] { width: 80px; padding: 8px; border-radius: 10px; border: 1px solid var(--border); background: #0f0f12; color: var(--text); }
    .toggle { display: inline-flex; align-items: center; gap: 8px; user-select: none; cursor: pointer; }
    .toggle input { appearance: none; width: 42px; height: 24px; border-radius: 999px; background: #34343a; position: relative; outline: none; transition: background .2s ease; border: 1px solid var(--border); cursor: pointer; }
    .toggle input::after { content: ""; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; border-radius: 50%; background: #bbb; transition: left .2s ease, background .2s ease; }
    .toggle input:checked { background: #224a2f; }
    .toggle input:checked::after { left: 22px; background: var(--accent); }
    .hint { color: var(--muted); font-size: 12px; margin-top: 4px; }
    .dropzone { border: 1px dashed #3a3a3f; border-radius: 12px; padding: 14px; text-align: center; background: #101014; cursor: pointer; transition: all 0.2s; }
    .dropzone.drag { border-color: #7ee787; background: #0c1610; }
    .dz-actions { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 8px; }
    button, .btn { appearance: none; border: 1px solid var(--border); background: #0f0f12; color: var(--text); padding: 8px 12px; border-radius: 10px; cursor: pointer; font-size: 14px; transition: background 0.2s; }
    button:hover, .btn:hover { background: #15151a; }
    button:active { transform: scale(0.98); }
    input[type="file"], input[type="text"] { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: #0f0f12; color: var(--text); }
    canvas { width: 100%; height: calc(100vh - 32px - 65px); display: block; background: #111114; border: 1px solid var(--border); border-radius: 14px; image-rendering: crisp-edges; }
    .foot { margin-top: 6px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center; justify-content: space-between; font-size: 12px; color: var(--muted); }
    .info-box { background: rgba(126,231,135,0.1); border: 1px solid var(--accent); border-radius: 8px; padding: 8px 12px; margin-top: 12px; font-size: 12px; }
  </style>
</head>
<body>
  <header>
    <div class="left">
      <div class="brand">PatternRipple</div>
      <span class="pill">Free Tool</span>
    </div>
    <nav class="right" aria-label="navigation">
      <a class="btn" href="https://www.patternripple.com">Browse Patterns</a>
    </nav>
  </header>
  <main>
    <section class="panel controls" aria-label="controls">
      <h2>Seamless Pattern Checker</h2>
      
      <div class="info-box">
        <strong>Free tool!</strong> Test any image for seamless tiling. Perfect for checking pattern edges before purchasing or using in your designs.
      </div>

      <hr style="border: none; border-top: 1px solid var(--border); margin: 14px 0" />

      <h2>Tile Settings</h2>
      <div class="row">
        <label for="cols">Columns</label>
        <input id="cols" type="number" min="1" max="20" step="1" value="4" />
      </div>

      <div class="row">
        <label for="rows">Rows</label>
        <input id="rows" type="number" min="1" max="20" step="1" value="4" />
      </div>

      <div class="row">
        <label for="gapToggle">Show Gaps: <span id="gapLabel">Off</span></label>
        <label class="toggle">
          <input id="gapToggle" type="checkbox" />
        </label>
      </div>

      <div class="row" id="gapSizeRow" style="opacity: 0.5;">
        <label for="gapSize">Gap size (px)</label>
        <input id="gapSize" type="number" min="0" max="64" step="1" value="16" disabled />
      </div>
      <div class="hint">Enable gaps to reveal seams between tiles - perfect for quality checking!</div>

      <hr style="border: none; border-top: 1px solid var(--border); margin: 14px 0" />

      <h2>Upload Image</h2>
      <div class="dropzone" id="dropzone">
        <div><strong>üñºÔ∏è Drop an image here</strong></div>
        <div style="margin-top: 8px;">or click to browse</div>
        <div class="dz-actions">
          <input id="fileInput" type="file" accept="image/*" style="display: none;" />
        </div>
        <div class="dz-actions">
          <input id="urlInput" type="text" placeholder="...or paste image URL (https://)" />
          <button id="loadUrlBtn">Load from URL</button>
        </div>
      </div>
      <div class="hint">Supports PNG, JPG, GIF, WebP. Max recommended: 4096x4096px</div>

      <div class="foot">
        <span>üí° Tip: Use 4√ó4 with gaps ON to check seams</span>
        <a href="https://www.patternripple.com">Visit PatternRipple ‚Üí</a>
      </div>
    </section>

    <section class="panel">
      <canvas id="canvas" aria-label="preview"></canvas>
    </section>
  </main>
  <script>
    (function() {
      'use strict';
      
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d', { alpha: false });
      const colsEl = document.getElementById('cols');
      const rowsEl = document.getElementById('rows');
      const gapToggleEl = document.getElementById('gapToggle');
      const gapLabel = document.getElementById('gapLabel');
      const gapSizeEl = document.getElementById('gapSize');
      const gapSizeRow = document.getElementById('gapSizeRow');
      const fileInput = document.getElementById('fileInput');
      const urlInput = document.getElementById('urlInput');
      const loadUrlBtn = document.getElementById('loadUrlBtn');
      const dropzone = document.getElementById('dropzone');

      let img = null;
      let imgW = 0, imgH = 0;
      let animFrame = null;

      function resizeCanvas() {
        const rect = canvas.getBoundingClientRect();
        const dpr = Math.min(2, window.devicePixelRatio || 1);
        canvas.width = Math.floor(rect.width * dpr);
        canvas.height = Math.floor(rect.height * dpr);
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        scheduleDraw();
      }
      
      function scheduleDraw() {
        if (animFrame) cancelAnimationFrame(animFrame);
        animFrame = requestAnimationFrame(draw);
      }
      
      window.addEventListener('resize', resizeCanvas, { passive: true });

      function setGapLabel() {
        const enabled = gapToggleEl.checked;
        gapLabel.textContent = enabled ? 'On' : 'Off';
        gapSizeEl.disabled = !enabled;
        gapSizeRow.style.opacity = enabled ? '1' : '0.5';
      }

      function draw() {
        const w = canvas.width / (window.devicePixelRatio || 1);
        const h = canvas.height / (window.devicePixelRatio || 1);
        
        ctx.fillStyle = '#0f0f12';
        ctx.fillRect(0, 0, w, h);

        if (!img) {
          // Empty state with grid
          ctx.strokeStyle = 'rgba(36,36,42,0.5)';
          ctx.lineWidth = 1;
          const step = 32;
          for (let x = 0; x <= w; x += step) {
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, h);
            ctx.stroke();
          }
          for (let y = 0; y <= h; y += step) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(w, y);
            ctx.stroke();
          }
          
          ctx.fillStyle = '#9aa0a6';
          ctx.font = '14px system-ui, -apple-system, sans-serif';
          ctx.textAlign = 'center';
          ctx.fillText('Drop or select an image to preview seamless tiling', w/2, h/2);
          return;
        }

        const cols = Math.max(1, Math.min(50, parseInt(colsEl.value || '4', 10)));
        const rows = Math.max(1, Math.min(50, parseInt(rowsEl.value || '4', 10)));
        const gapOn = gapToggleEl.checked;
        const gap = gapOn ? Math.max(0, Math.min(64, parseInt(gapSizeEl.value || '6', 10))) : 0;

        const totalGapX = gap * (cols - 1);
        const totalGapY = gap * (rows - 1);

        const cellW = imgW;
        const cellH = imgH;
        let gridW = cols * cellW + totalGapX;
        let gridH = rows * cellH + totalGapY;

        const pad = 24;
        const maxW = w - pad * 2;
        const maxH = h - pad * 2;
        const scale = Math.min(1, Math.min(maxW / gridW, maxH / gridH));
        const tileW = Math.floor(cellW * scale);
        const tileH = Math.floor(cellH * scale);
        const g = Math.floor(gap * scale);

        gridW = cols * tileW + g * (cols - 1);
        gridH = rows * tileH + g * (rows - 1);

        const startX = Math.floor((w - gridW) / 2);
        const startY = Math.floor((h - gridH) / 2);

        // Draw background for gaps if enabled
        if (gapOn && g > 0) {
          ctx.fillStyle = '#0b0b0c';
          ctx.fillRect(startX, startY, gridW, gridH);
        }

        // Draw tiles
        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            const x = startX + c * (tileW + g);
            const y = startY + r * (tileH + g);
            ctx.drawImage(img, 0, 0, imgW, imgH, x, y, tileW, tileH);
          }
        }
      }

      function loadFromFile(file) {
        if (!file) return;
        if (file.size > 50 * 1024 * 1024) { // 50MB limit
          alert('File too large. Please use an image under 50MB.');
          return;
        }
        const reader = new FileReader();
        reader.onload = e => loadFromSrc(e.target.result);
        reader.onerror = () => alert('Failed to read file.');
        reader.readAsDataURL(file);
      }

      function loadFromSrc(src) {
        const i = new Image();
        i.crossOrigin = 'anonymous';
        i.onload = () => {
          img = i;
          imgW = i.naturalWidth || i.width;
          imgH = i.naturalHeight || i.height;
          scheduleDraw();
        };
        i.onerror = () => {
          alert('Failed to load image. If loading from URL, the site may not allow cross-origin requests.');
        };
        i.src = src;
      }

      // File input
      dropzone.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', e => {
        const f = e.target.files && e.target.files[0];
        if (f) loadFromFile(f);
      });

      // URL loading
      loadUrlBtn.addEventListener('click', () => {
        const u = (urlInput.value || '').trim();
        if (!u) return;
        if (!u.match(/^https?:\/\//)) {
          alert('Please enter a valid URL starting with http:// or https://');
          return;
        }
        loadFromSrc(u);
      });
      
      urlInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') loadUrlBtn.click();
      });

      // Drag & drop
      ['dragenter','dragover'].forEach(evt => {
        dropzone.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
          dropzone.classList.add('drag');
        });
      });
      
      ['dragleave','drop'].forEach(evt => {
        dropzone.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
          dropzone.classList.remove('drag');
        });
      });
      
      dropzone.addEventListener('drop', e => {
        const files = e.dataTransfer?.files;
        if (files && files.length > 0) {
          loadFromFile(files[0]);
        }
      });

      // Control listeners
      gapToggleEl.addEventListener('change', () => {
        setGapLabel();
        scheduleDraw();
      });
      
      [colsEl, rowsEl, gapSizeEl].forEach(el => {
        el.addEventListener('input', scheduleDraw);
        el.addEventListener('change', scheduleDraw);
      });

      // Initialize
      setGapLabel();
      resizeCanvas();
    })();
  </script>
</body>
</html>
