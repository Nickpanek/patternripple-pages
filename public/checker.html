<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="base-uri 'none'; object-src 'none'; script-src 'strict-dynamic' 'nonce-PRCHECK'; style-src 'unsafe-inline'; img-src 'self' data: blob:; connect-src 'self'; default-src 'self'">
  <title>Seamless Pattern Checker - PatternRipple</title>
  <meta name="description" content="Quickly preview any image as a seamless tile. Upload an image and see a 4x4 repeat with optional 6px gaps to inspect seams." />
  <style>
    :root { --bg: #0b0b0c; --panel: #151518; --text: #eaeaf0; --muted: #9aa0a6; --border: #232327; --accent: #7ee787; }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    a { color: #9ecbff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    header { padding: 16px; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 10; backdrop-filter: blur(6px); }
    header .left { display: flex; align-items: center; gap: 12px; }
    header .brand { font-weight: 700; letter-spacing: 0.2px; }
    main { max-width: 1200px; margin: 0 auto; padding: 24px; display: grid; gap: 24px; grid-template-columns: 360px 1fr; }
    @media (max-width: 960px) { main { grid-template-columns: 1fr; } }
    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
    .controls label { display: block; font-size: 14px; color: var(--muted); margin-top: 12px; }
    .controls input[type="file"] { width: 100%; margin-top: 6px; }
    .row { display: flex; gap: 12px; align-items: center; margin-top: 10px; }
    .btn { padding: 8px 12px; border: 1px solid var(--border); background: #1b1b1f; border-radius: 10px; cursor: pointer; }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .grid { width: 100%; aspect-ratio: 1/1; background: #0f0f12; border-radius: 12px; overflow: hidden; display: grid; place-items: center; }
    canvas { display: block; max-width: 100%; height: auto; outline: 1px solid var(--border); }
    .hint { color: var(--muted); font-size: 13px; margin-top: 8px; }
    .toggle { display: inline-flex; align-items: center; gap: 8px; user-select: none; }
    .badge { font-size: 12px; padding: 4px 8px; border: 1px solid var(--border); border-radius: 999px; color: var(--muted); }
    footer { padding: 20px; color: var(--muted); text-align: center; }
  </style>
</head>
<body>
  <header>
    <div class="left">
      <span class="brand">PatternRipple - Seamless Checker</span>
      <span class="badge">4x4</span>
      <span class="badge" id="gapBadge">Gaps: Off</span>
    </div>
  </header>

  <main>
    <section class="panel controls">
      <label>Upload image</label>
      <input id="file" type="file" accept="image/*" />
      <div class="hint">PNG or JPG works best. Square tiles are ideal, but any image is fine.</div>

      <label style="margin-top:16px;">Options</label>
      <div class="row">
        <button class="btn" id="toggleGaps">Toggle 6px Gaps</button>
        <span class="hint">Quickly inspect seams by adding 6px spacing between tiles.</span>
      </div>

      <div class="row" style="margin-top:16px;">
        <a class="btn" href="https://www.patternripple.com/collections/faux-embroidery">Shop Patterns</a>
        <a class="btn" href="https://www.buymeacoffee.com/prompternick" target="_blank" rel="noopener">Buy Me a Coffee</a>
      </div>
    </section>

    <section class="panel">
      <div class="grid">
        <canvas id="view" width="1024" height="1024"></canvas>
      </div>
      <div class="hint" style="margin-top:12px;">
        Tip: Use large source images when possible for cleaner previews.
      </div>
    </section>
  </main>

  <footer>
    © PatternRipple. This page is a static HTML file with its own script sandbox, so your browser and CDN won’t mix it with the Next app.
  </footer>

  <script nonce="PRCHECK">
    const fileInput = document.getElementById('file');
    const canvas = document.getElementById('view');
    const ctx = canvas.getContext('2d');
    const toggleGapsBtn = document.getElementById('toggleGaps');
    const gapBadge = document.getElementById('gapBadge');

    const GRID = 4;            // fixed 4x4
    let gapsOn = false;        // default Off - user can toggle to On 6px

    function updateBadge() {
      gapBadge.textContent = `Gaps: ${gapsOn ? 'On' : 'Off'}`;
    }
    updateBadge();

    function drawPreview(img) {
      const tileW = img.width;
      const tileH = img.height;
      const gap = gapsOn ? 6 : 0;

      // compute size per tile including gap
      const cells = GRID;
      const totalGapX = gap * (cells - 1);
      const totalGapY = gap * (cells - 1);

      // scale so the 4x4 fits in canvas while preserving tile ratio
      const maxCanvas = Math.min(canvas.width, canvas.height);
      const scaleX = (maxCanvas - totalGapX) / (cells * tileW);
      const scaleY = (maxCanvas - totalGapY) / (cells * tileH);
      const scale = Math.min(scaleX, scaleY);

      const drawW = Math.floor(tileW * scale);
      const drawH = Math.floor(tileH * scale);
      const gridW = drawW * cells + totalGapX;
      const gridH = drawH * cells + totalGapY;

      // center
      const startX = Math.floor((canvas.width - gridW) / 2);
      const startY = Math.floor((canvas.height - gridH) / 2);

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let y = 0; y < cells; y++) {
        for (let x = 0; x < cells; x++) {
          const dx = startX + x * (drawW + gap);
          const dy = startY + y * (drawH + gap);
          ctx.drawImage(img, dx, dy, drawW, drawH);
        }
      }
    }

    function readFile(file) {
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = () => {
        drawPreview(img);
        URL.revokeObjectURL(url);
      };
      img.onerror = () => {
        alert('Could not load that image file.');
        URL.revokeObjectURL(url);
      };
      img.src = url;
    }

    fileInput.addEventListener('change', () => {
      const f = fileInput.files && fileInput.files[0];
      if (f) readFile(f);
    });

    toggleGapsBtn.addEventListener('click', () => {
      gapsOn = !gapsOn;
      updateBadge();
      // redraw with last image if present by using the canvas as src
      // no stored image, so just ask the file input again if empty
      const f = fileInput.files && fileInput.files[0];
      if (f) {
        readFile(f);
      }
    });
  </script>
</body>
</html>
