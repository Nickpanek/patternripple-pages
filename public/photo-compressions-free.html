<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Photo Compressions Lab - Free | PatternRipple</title>
  <meta name="description" content="Free browser-based photo compressor by PatternRipple. Resize, compress, watermark, and export JPEGs locally. No uploads. No tracking." />
  <link rel="icon" href="data:," />
  <meta name="color-scheme" content="light dark" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <style>
    :root { color-scheme: light dark; }
    .dropzone { border: 2px dashed #94a3b8; transition: border-color .15s, background-color .15s; }
    .dropzone.dragover { border-color: #10b981; background-color: #f0fdf4; }
    .thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; }
    .toast { position: fixed; right: 16px; bottom: 16px; padding: 10px 14px; border-radius: 8px; background: #111827; color: #fff; opacity: .95; }
    ::placeholder { color: #475569; opacity: 1; }
    input[type="range"]::-webkit-slider-runnable-track { height: 6px; background: #cbd5e1; border-radius: 3px; }
    input[type="range"]::-moz-range-track { height: 6px; background: #cbd5e1; border-radius: 3px; }
    :focus-visible { outline: 2px solid #10b981; outline-offset: 2px; }
    .link-quiet { color:#64748b; text-underline-offset:3px; }
    .link-quiet:hover { color:#0f766e; text-decoration: underline; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900 antialiased">
  <noscript>
    <div class="max-w-6xl mx-auto px-4 py-3">
      <div class="rounded border bg-rose-50 text-rose-900 p-3 text-sm">JavaScript is required for this tool.</div>
    </div>
  </noscript>

  <header class="border-b bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/70">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-lg sm:text-xl font-semibold tracking-tight">Photo Compressions Lab - Free</h1>
      <nav aria-label="Upgrade">
        <a href="https://gumroad.com/l/patternripple-photo-compressions-pro" target="_blank" rel="noopener" class="link-quiet text-sm" aria-label="Open Pro version on Gumroad in a new tab">Upgrade to Pro</a>
      </nav>
    </div>
  </header>

  <div id="onboard" class="max-w-6xl mx-auto px-4 pt-3 hidden">
    <div class="rounded border bg-amber-50 text-amber-900 p-3 text-sm flex items-start justify-between gap-3">
      <p class="leading-relaxed">
        Drag JPEGs into the box, choose settings, then export a ZIP.
        Free has unlimited runs and includes your watermark, with 5 photos per export.
        Pro removes the small “PatternRipple Free” corner tag and export cap.
      </p>
      <button id="onboardClose" class="shrink-0 px-2 py-1 text-xs rounded bg-amber-200 hover:bg-amber-300">Got it</button>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <section class="lg:col-span-1 space-y-4">
      <div class="p-4 bg-white rounded-lg border space-y-3">
        <h2 class="font-semibold">Resize</h2>
        <label class="block text-sm" for="inpLongEdge">Long edge (px)</label>
        <input id="inpLongEdge" type="number" inputmode="numeric" value="2500" class="mt-1 w-full border rounded px-2 py-1" />
      </div>

      <div class="p-4 bg-white rounded-lg border space-y-3">
        <h2 class="font-semibold">Compression</h2>
        <label class="block text-sm" for="inpQuality">JPEG quality (0-100)</label>
        <input id="inpQuality" type="number" inputmode="numeric" value="80" class="mt-1 w-full border rounded px-2 py-1" />
        <label class="inline-flex items-center gap-2 text-sm" for="chkStrip">
          <input id="chkStrip" type="checkbox" class="accent-emerald-600" checked />
          Strip metadata
        </label>
      </div>

      <div class="p-4 bg-white rounded-lg border space-y-3">
        <h2 class="font-semibold">Watermark</h2>
        <label class="block text-sm" for="wmText">Text watermark</label>
        <input id="wmText" type="text" placeholder="Your studio name" class="mt-1 w-full border rounded px-2 py-1" />
        <label class="block text-sm" for="wmOpacity">Opacity</label>
        <input id="wmOpacity" type="range" min="0" max="1" step="0.05" value="0.2" class="w-full" />
        <p class="text-xs text-slate-500">Your watermark is included. Pro removes the small “PatternRipple Free” corner tag.</p>
      </div>

      <div class="p-4 bg-white rounded-lg border space-y-3">
        <h2 class="font-semibold">Batch</h2>
        <p class="text-sm text-slate-600">Unlimited runs. Up to 5 photos per export ZIP.</p>
        <button id="btnExport" class="w-full px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700 focus-visible:outline-none">Export ZIP</button>
      </div>
    </section>

    <section class="lg:col-span-2 space-y-4">
      <div id="dropzone" class="dropzone p-8 bg-white rounded-lg border flex flex-col items-center justify-center text-center" aria-describedby="dropHelp">
        <p class="text-base font-medium">Drag and drop images</p>
        <p class="text-sm text-slate-500">or</p>
        <label for="fileInput" class="mt-2 px-3 py-2 rounded bg-slate-200 hover:bg-slate-300 cursor-pointer inline-block">Browse files</label>
        <input id="fileInput" type="file" accept="image/jpeg,image/jpg,image/pjpeg" multiple class="hidden" />
        <p id="dropHelp" class="mt-3 text-xs text-slate-400">JPEG only for now</p>
      </div>

      <div class="p-4 bg-white rounded-lg border">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold">Queue</h2>
          <button id="btnClear" class="px-3 py-2 text-sm rounded bg-slate-200 hover:bg-slate-300">Clear</button>
        </div>
        <div id="queue" class="mt-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
      </div>

      <div class="p-4 bg-white rounded-lg border">
        <h2 class="font-semibold mb-2">Progress</h2>
        <div id="progressContainer" class="w-full bg-slate-200 rounded h-3 overflow-hidden" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div id="bar" class="h-3 bg-emerald-600" style="width:0%"></div>
        </div>
        <p id="status" class="mt-2 text-sm text-slate-600" aria-live="polite">Idle</p>
      </div>
    </section>
  </main>

  <footer class="border-t bg-white">
    <div class="max-w-6xl mx-auto px-4 py-6 text-sm text-slate-500">
      100% local processing. No uploads. No tracking. © PatternRipple Labs.
      <span class="mx-2">•</span>
      <a href="#YOUR_BMAC_LINK_HERE" target="_blank" rel="noopener" class="link-quiet">Support this tool</a>
      <span class="mx-2">•</span>
      <a href="https://gumroad.com/l/patternripple-photo-compressions-pro" target="_blank" rel="noopener" class="link-quiet">Pro version</a>
    </div>
  </footer>

  <div id="toast" class="toast hidden" aria-live="assertive"></div>

  <!-- config must load before app.js -->
  <script>
    window.PCL_CONFIG = {
      IS_PRO: false,
      FREE_MAX_PER_EXPORT: 5,
      FREE_BADGE_TEXT: 'PatternRipple Free',
      FREE_BADGE_OPACITY: 0.55,
      MAX_JPEG_QUALITY: 100
    };
  </script>

  <!-- tiny helpers that stay in HTML -->
  <script>
    // Onboarding
    (function () {
      const key = 'pcl_onboard_dismissed';
      const wrap = document.getElementById('onboard');
      if (!localStorage.getItem(key)) wrap.classList.remove('hidden');
      document.getElementById('onboardClose')?.addEventListener('click', () => { localStorage.setItem(key, '1'); wrap.remove(); }, { passive: true });
    })();
    // Drag highlight only
    (function () {
      const dz = document.getElementById('dropzone');
      if (!dz) return;
      ['dragenter','dragover'].forEach(ev => dz.addEventListener(ev, e => { e.preventDefault(); dz.classList.add('dragover'); }, { passive:false }));
      ['dragleave','drop'].forEach(ev => dz.addEventListener(ev, e => { e.preventDefault(); dz.classList.remove('dragover'); }, { passive:false }));
    })();
    // Keyboard shortcut
    addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'f' && !/input|textarea|select/i.test(document.activeElement.tagName)) {
        document.getElementById('fileInput')?.click();
      }
    }, { passive: true });
    // progress bridge used by app.js
    window.__pclSetProgress = function(pct){
      const pc = document.getElementById('progressContainer');
      const bar = document.getElementById('bar');
      const v = Math.max(0, Math.min(100, Number(pct) || 0));
      if (bar) bar.style.width = v + '%';
      if (pc) pc.setAttribute('aria-valuenow', String(v));
    };
  </script>

  <!-- your app logic (moved) -->
  <script src="/public/app.js" defer></script>
</body>
</html>